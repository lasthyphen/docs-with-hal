(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3588],{92541:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guides/nodes/offline-pruning-utility-chain",function(){return t(30625)}])},30625:function(e,n,t){"use strict";t.r(n),t.d(n,{CH:function(){return s},Page:function(){return l},chCodeConfig:function(){return c},meta:function(){return d}});var o=t(52322),r=t(3905),i=t(65854),a=t(72499),s={annotations:i.ds,Code:i.EK},c={staticMediaQuery:"not screen, (max-width: 768px)",theme:{name:"supabase",type:"from-css",tokenColors:[{scope:["comment","punctuation.definition.comment","string.comment"],settings:{foreground:"var(--ch-1)"}},{scope:["constant","entity.name.constant","variable.other.constant","variable.other.enummember","variable.language","entity"],settings:{foreground:"var(--ch-2)"}},{scope:["entity.name","meta.export.default","meta.definition.variable"],settings:{foreground:"var(--ch-3)"}},{scope:["variable.parameter.function","meta.jsx.children","meta.block","meta.tag.attributes","entity.name.constant","meta.object.member","meta.embedded.expression"],settings:{foreground:"var(--ch-4)"}},{scope:"entity.name.function",settings:{foreground:"var(--ch-5)"}},{scope:["entity.name.tag","support.class.component"],settings:{foreground:"var(--ch-6)"}},{scope:"keyword",settings:{foreground:"var(--ch-7)"}},{scope:["storage","storage.type"],settings:{foreground:"var(--ch-7)"}},{scope:["storage.modifier.package","storage.modifier.import","storage.type.java"],settings:{foreground:"var(--ch-4)"}},{scope:["string","string punctuation.section.embedded source"],settings:{foreground:"var(--ch-8)"}},{scope:"support",settings:{foreground:"var(--ch-2)"}},{scope:"meta.property-name",settings:{foreground:"var(--ch-2)"}},{scope:"variable",settings:{foreground:"var(--ch-3)"}},{scope:"variable.other",settings:{foreground:"var(--ch-4)"}},{scope:"invalid.broken",settings:{foreground:"var(--ch-9)",fontStyle:"italic"}},{scope:"invalid.deprecated",settings:{foreground:"var(--ch-9)",fontStyle:"italic"}},{scope:"invalid.illegal",settings:{foreground:"var(--ch-9)",fontStyle:"italic"}},{scope:"invalid.unimplemented",settings:{foreground:"var(--ch-9)",fontStyle:"italic"}},{scope:"carriage-return",settings:{background:"var(--ch-7)",foreground:"var(--ch-10)",fontStyle:"italic underline"}},{scope:"message.error",settings:{foreground:"var(--ch-9)"}},{scope:"string variable",settings:{foreground:"var(--ch-2)"}},{scope:["source.regexp","string.regexp"],settings:{foreground:"var(--ch-8)"}},{scope:["string.regexp.character-class","string.regexp constant.character.escape","string.regexp source.ruby.embedded","string.regexp string.regexp.arbitrary-repitition"],settings:{foreground:"var(--ch-8)"}},{scope:"string.regexp constant.character.escape",settings:{foreground:"var(--ch-6)",fontStyle:"bold"}},{scope:"support.constant",settings:{foreground:"var(--ch-2)"}},{scope:"support.variable",settings:{foreground:"var(--ch-2)"}},{scope:"support.type.property-name.json",settings:{foreground:"var(--ch-6)"}},{scope:"meta.module-reference",settings:{foreground:"var(--ch-2)"}},{scope:"punctuation.definition.list.begin.markdown",settings:{foreground:"var(--ch-3)"}},{scope:["markup.heading","markup.heading entity.name"],settings:{foreground:"var(--ch-2)",fontStyle:"bold"}},{scope:"markup.quote",settings:{foreground:"var(--ch-6)"}},{scope:"markup.italic",settings:{foreground:"var(--ch-4)",fontStyle:"italic"}},{scope:"markup.bold",settings:{foreground:"var(--ch-4)",fontStyle:"bold"}},{scope:["markup.underline"],settings:{fontStyle:"underline"}},{scope:["markup.strikethrough"],settings:{fontStyle:"strikethrough"}},{scope:"markup.inline.raw",settings:{foreground:"var(--ch-2)"}},{scope:["markup.deleted","meta.diff.header.from-file","punctuation.definition.deleted"],settings:{background:"var(--ch-11)",foreground:"var(--ch-9)"}},{scope:["punctuation.section.embedded"],settings:{foreground:"var(--ch-7)"}},{scope:["markup.inserted","meta.diff.header.to-file","punctuation.definition.inserted"],settings:{background:"var(--ch-12)",foreground:"var(--ch-6)"}},{scope:["markup.changed","punctuation.definition.changed"],settings:{background:"var(--ch-13)",foreground:"var(--ch-3)"}},{scope:["markup.ignored","markup.untracked"],settings:{background:"var(--ch-2)",foreground:"var(--ch-14)"}},{scope:"meta.diff.range",settings:{foreground:"var(--ch-5)",fontStyle:"bold"}},{scope:"meta.diff.header",settings:{foreground:"var(--ch-2)"}},{scope:"meta.separator",settings:{foreground:"var(--ch-2)",fontStyle:"bold"}},{scope:"meta.output",settings:{foreground:"var(--ch-2)"}},{scope:["brackethighlighter.tag","brackethighlighter.curly","brackethighlighter.round","brackethighlighter.square","brackethighlighter.angle","brackethighlighter.quote"],settings:{foreground:"var(--ch-15)"}},{scope:"brackethighlighter.unmatched",settings:{foreground:"var(--ch-9)"}},{scope:["constant.other.reference.link","string.other.link"],settings:{foreground:"var(--ch-8)",fontStyle:"underline"}}],colors:{"editor.background":"var(--ch-16)","editor.foreground":"var(--ch-4)","editor.selectionBackground":"var(--ch-17)","editor.infoForeground":"var(--ch-18)","editor.rangeHighlightBackground":"var(--ch-19)","editorLineNumber.foreground":"var(--ch-20)","tab.activeBackground":"var(--ch-16)","tab.inactiveBackground":"var(--ch-21)","tab.activeForeground":"var(--ch-4)","tab.inactiveForeground":"var(--ch-15)","tab.border":"var(--ch-22)","tab.activeBorder":"var(--ch-16)","tab.activeBorderTop":"var(--ch-23)","tab.hoverBackground":"var(--ch-16)","tab.hoverForeground":"var(--ch-15)","editorGroupHeader.tabsBorder":"var(--ch-22)","editorGroupHeader.tabsBackground":"var(--ch-21)","list.inactiveSelectionBackground":"var(--ch-24)","list.inactiveSelectionForeground":"var(--ch-4)","list.hoverBackground":"var(--ch-25)","list.hoverForeground":"var(--ch-4)"}},lineNumbers:!0,showCopyButton:!0,autoImport:!0,skipLanguages:[],filepath:"/Users/saleemfareed/Documents/hal-docs/apps/docs/pages/guides/nodes/offline-pruning-utility-chain.mdx"},d={id:"nodes-offline-pruning-utility-chain",title:"Offline Pruning in Utility Chain",description:"How to enable offline pruning in Dijets Utility Chain"},l=function(e){var n=e.children;return(0,o.jsx)(a.Z,{meta:d,children:n})},h=l;function u(e){var n=Object.assign({h2:"h2",p:"p",code:"code",strong:"strong",a:"a"},(0,r.ah)(),e.components);return s||g("CH",!1),s.Code||g("CH.Code",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsxs)(n.p,{children:["Offline Pruning is ported from ",(0,o.jsx)(n.code,{children:"go-ethereum"})," to reduce the amount of disk space\ntaken up by the TrieDB (storage for the Merkle Forest)."]}),"\n",(0,o.jsx)(n.p,{children:"Offline pruning creates a bloom filter and adds all trie nodes in the active\nstate to the bloom filter to mark the data as protected. This ensures that any\npart of the active state will not be removed during offline pruning."}),"\n",(0,o.jsx)(n.p,{children:"After generating the bloom filter, offline pruning iterates over the database\nand searches for trie nodes that are safe to be removed from disk."}),"\n",(0,o.jsx)(n.p,{children:"A bloom filter is a probabilistic data structure that reports whether an item is\ndefinitely not in a set or possibly in a set. Therefore, for each key we\niterate, we check if it is in the bloom filter. If the key is definitely not in\nthe bloom filter, then it is not in the active state and we can safely delete\nit. If the key is possibly in the set, then we skip over it to ensure we do not\ndelete any active state."}),"\n",(0,o.jsx)(n.p,{children:"During iteration, the underlying database (LevelDB) writes deletion markers,\ncausing a temporary increase in disk usage."}),"\n",(0,o.jsx)(n.p,{children:"After iterating over the database and deleting any old trie nodes that it can,\noffline pruning then runs compaction to minimize the DB size after the\npotentially large number of delete operations."}),"\n",(0,o.jsx)(n.h2,{id:"finding-the-utility-chain-config-file",children:"Finding the Utility Chain Config File"}),"\n",(0,o.jsxs)(n.p,{children:["In order to enable offline pruning, you need to update the Utility Chain config file\nto include the parameters ",(0,o.jsx)(n.code,{children:"offline-pruning-enabled"})," and\n",(0,o.jsx)(n.code,{children:"offline-pruning-data-directory"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["The default location of the Utility Chain config file is\n",(0,o.jsx)(n.code,{children:"~/.dijetsnodego/configs/chains/C/config.json"}),". ",(0,o.jsx)(n.strong,{children:"Please note that by default,\nthis file does not exist. You would need to create it manually."})," You can update\nthe directory for chain configs by passing in the directory of your choice via\nthe CLI argument: ",(0,o.jsx)(n.code,{children:"chain-config-dir"}),". See ",(0,o.jsx)(n.a,{href:"node-flags-configs",children:"this"})," for more\ninfo. For example, if you start your node with:"]}),"\n",(0,o.jsx)(s.Code,{codeConfig:c,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"./build/dijetsnodego ",props:{style:{color:"var(--ch-3)"}}},{content:"--chain-config-dir=/home/ubuntu/chain-configs",props:{style:{color:"var(--ch-2)"}}}]}],lang:"zsh"},annotations:[]}]}),"\n",(0,o.jsxs)(n.p,{children:["The chain config directory will be updated to ",(0,o.jsx)(n.code,{children:"/home/ubuntu/chain-configs"})," and\nthe corresponding Utility Chain config file will be:\n",(0,o.jsx)(n.code,{children:"/home/ubuntu/chain-configs/C/config.json"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"running-offline-pruning",children:"Running Offline Pruning"}),"\n",(0,o.jsx)(n.p,{children:"In order to enable offline pruning, update the Utility Chain config file to include the following parameters:"}),"\n",(0,o.jsx)(s.Code,{codeConfig:c,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"{",props:{style:{color:"var(--ch-4)"}}}]},{tokens:[{content:'  "offline-pruning-enabled"',props:{style:{color:"var(--ch-6)"}}},{content:": ",props:{style:{color:"var(--ch-4)"}}},{content:"true",props:{style:{color:"var(--ch-2)"}}},{content:",",props:{style:{color:"var(--ch-4)"}}}]},{tokens:[{content:'  "offline-pruning-data-directory"',props:{style:{color:"var(--ch-6)"}}},{content:": ",props:{style:{color:"var(--ch-4)"}}},{content:'"/home/ubuntu/offline-pruning"',props:{style:{color:"var(--ch-8)"}}}]},{tokens:[{content:"}",props:{style:{color:"var(--ch-4)"}}}]}],lang:"json"},annotations:[]}]}),"\n",(0,o.jsxs)(n.p,{children:["This will set ",(0,o.jsx)(n.code,{children:"/home/ubuntu/offline-pruning"})," as the directory to be used by the\noffline pruner. Offline pruning will store the bloom filter in this location, so\nyou must ensure that the path exists."]}),"\n",(0,o.jsx)(n.p,{children:"Now that the Utility Chain config file has been updated, you can start your node with\nthe command (no CLI arguments are necessary if using the default chain config\ndirectory):"}),"\n",(0,o.jsx)(s.Code,{codeConfig:c,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"./build/dijetsnodego",props:{style:{color:"var(--ch-3)"}}}]}],lang:"zsh"},annotations:[]}]}),"\n",(0,o.jsx)(n.p,{children:"The bloom filter should be populated and committed to disk after about 5\nminutes. At this point, if the node shuts down, it will resume the offline\npruning session when it restarts (note: this operation cannot be cancelled)."}),"\n",(0,o.jsx)(n.p,{children:"In order to ensure that users do not mistakenly leave offline pruning enabled\nfor the long term (which could result in an hour of downtime on each restart),\nwe have added a manual protection which requires that after an offline pruning\nsession, the node must be started with offline pruning disabled at least once\nbefore it will start with offline pruning enabled again. Therefore, once the\nbloom filter has been committed to disk, you should update the Utility Chain config\nfile to include the following parameters:"}),"\n",(0,o.jsx)(s.Code,{codeConfig:c,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"{",props:{style:{color:"var(--ch-4)"}}}]},{tokens:[{content:'  "offline-pruning-enabled"',props:{style:{color:"var(--ch-6)"}}},{content:": ",props:{style:{color:"var(--ch-4)"}}},{content:"false",props:{style:{color:"var(--ch-2)"}}},{content:",",props:{style:{color:"var(--ch-4)"}}}]},{tokens:[{content:'  "offline-pruning-data-directory"',props:{style:{color:"var(--ch-6)"}}},{content:": ",props:{style:{color:"var(--ch-4)"}}},{content:'"/home/ubuntu/offline-pruning"',props:{style:{color:"var(--ch-8)"}}}]},{tokens:[{content:"}",props:{style:{color:"var(--ch-4)"}}}]}],lang:"json"},annotations:[]}]}),"\n",(0,o.jsx)(n.p,{children:"It is important to keep the same data directory in the config file, so that the\nnode knows where to look for the bloom filter on a restart if offline pruning\nhas not finished."}),"\n",(0,o.jsx)(n.p,{children:"Now if your node restarts, it will be marked as having correctly disabled\noffline pruning after the run and be allowed to resume normal operation once\noffline pruning has finished running."}),"\n",(0,o.jsx)(n.h2,{id:"disk-space-considerations",children:"Disk Space Considerations"}),"\n",(0,o.jsxs)(n.p,{children:["To ensure the node does not enter an inconsistent state, the bloom filter used\nfor pruning is persisted to ",(0,o.jsx)(n.code,{children:"offline-pruning-data-directory"})," for the duration of\nthe operation. This directory should have ",(0,o.jsx)(n.code,{children:"offline-pruning-bloom-filter-size"}),"\navailable in disk space (default 512 MB)."]}),"\n",(0,o.jsx)(n.p,{children:"The underlying database (LevelDB) uses deletion markers (tombstones) to identify\nnewly deleted keys. These markers are temporarily persisted to disk until they\nare removed during a process known as compaction. This will lead to an increase\nin disk usage during pruning. If your node runs out of disk space during\npruning, you may safely restart the pruning operation. This may succeed as\nrestarting the node triggers compaction."}),"\n",(0,o.jsx)(n.p,{children:"If restarting the pruning operation does not succeed, additional disk space should be provisioned."})]})}function g(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}n.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.jsx)(h,Object.assign({},e,{children:(0,o.jsx)(u,e)}))}}},function(e){e.O(0,[2331,2499,9774,2888,179],(function(){return n=92541,e(e.s=n);var n}));var n=e.O();_N_E=n}]);